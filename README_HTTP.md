# 心算对战游戏 - HTTP轮询版

这是一个不使用WebSocket的心算对战游戏实现，采用HTTP轮询方式实现实时对战功能。

## 特性

- ✅ 完全基于HTTP协议，无需WebSocket支持
- ✅ 支持双人对战模式
- ✅ 实时游戏状态同步（通过HTTP轮询）
- ✅ 房间管理系统
- ✅ 玩家名称自定义
- ✅ 自动重连机制
- ✅ 单人练习模式
- ✅ 响应式设计，支持移动设备

## 技术架构

### 后端
- **框架**: aiohttp (异步HTTP服务器)
- **通信方式**: HTTP API + 客户端轮询
- **轮询间隔**: 2秒
- **心跳间隔**: 10秒

### 前端
- **技术**: 原生JavaScript + Fetch API
- **状态管理**: 本地状态 + 服务器状态同步
- **连接指示器**: 实时显示连接状态

## 安装和运行

### 1. 安装依赖
```bash
# 使用uv（推荐）
uv add aiohttp aiohttp-cors

# 或使用pip
pip install aiohttp aiohttp-cors
```

### 2. 启动服务器

#### 本地访问模式
```bash
python run_http_server.py --local-only
```

#### 局域网访问模式
```bash
python run_http_server.py --host 0.0.0.0 --port 8000
```

#### 直接运行服务器
```bash
python http_server.py --host localhost --port 8000
```

### 3. 访问游戏

打开浏览器访问：
- **本地访问**: http://localhost:8000/index_http.html
- **游戏主页**: http://localhost:8000

## API接口

### 玩家管理
- `POST /api/register` - 注册玩家
- `POST /api/ping` - 心跳检测

### 房间管理
- `POST /api/create_room` - 创建房间
- `POST /api/join_room` - 加入房间
- `GET /api/room/{room_id}` - 获取房间状态

### 游戏控制
- `POST /api/start_game` - 开始游戏
- `POST /api/restart_game` - 重新开始游戏
- `POST /api/update_stats` - 更新玩家统计
- `POST /api/update_name` - 更新玩家名称

## 使用方法

### 基本操作
1. **创建房间**: 点击"创建房间"按钮
2. **邀请对手**: 分享生成的房间链接给对手
3. **加入房间**: 对手点击链接或手动输入房间ID
4. **开始游戏**: 双人都上线后，任意一人点击"开始游戏"
5. **进行对战**: 在60秒内尽可能多地完成心算题目

### 高级功能
- **修改名称**: 点击"编辑"按钮修改玩家名称
- **单人练习**: 点击"单人练习"进行本地练习
- **自定义服务器**: 点击"设置服务器"手动配置服务器地址

## 配置选项

### 服务器配置
- `--host`: 服务器侦听地址（默认: 0.0.0.0）
- `--port`: HTTP端口（默认: 8000）
- `--local-only`: 仅本地访问模式

### 游戏参数
- 游戏时长: 60秒
- 题目池大小: 200题
- 轮询间隔: 2秒
- 玩家超时: 15秒

## 故障排除

### 连接问题
1. **检查服务器状态**: 确保服务器正在运行
2. **检查防火墙**: 确保端口8000未被阻止
3. **检查网络**: 确保客户端可以访问服务器

### 性能优化
1. **调整轮询间隔**: 修改前端代码中的轮询频率
2. **优化超时设置**: 调整玩家超时时间
3. **启用压缩**: 在服务器端启用gzip压缩

## 开发说明

### 文件结构
```
match-cal/
├── http_server.py          # HTTP服务器主程序
├── run_http_server.py      # 服务器启动脚本
├── index_http.html         # HTTP轮询版前端页面
├── test_http_api.py        # API测试脚本
├── README_HTTP.md          # 本文档
└── requirements.txt        # 依赖包列表
```

### 与WebSocket版本的对比

| 特性 | WebSocket版本 | HTTP轮询版本 |
|------|---------------|--------------|
| 实时性 | 高（毫秒级） | 中等（秒级） |
| 兼容性 | 需要WebSocket支持 | 通用HTTP支持 |
| 资源消耗 | 较低（长连接） | 较高（频繁请求） |
| 部署复杂度 | 中等 | 简单 |
| 防火墙友好性 | 一般 | 优秀 |

### 扩展功能
可以轻松添加以下功能：
- 游戏房间密码保护
- 游戏历史记录
- 排行榜系统
- 多种游戏模式
- 管理员后台

## 许可证

本项目基于原有的WebSocket版本心算对战游戏修改而来，保持相同的许可证。